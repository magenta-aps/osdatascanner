{% extends 'organizations/base.html' %}
{% load i18n %}
{% load orgunit_tags %}

{% block title %}
  {% trans "organizational hierarchy"|capfirst %}
{% endblock %}

{% block content %}
  <div class="orgunit-list content-header">

    {% include "partials/breadcrumb.html" with page="orgunit_views" %}

    {% if FEATURES.ORG_STRUCTURE in organization.client.enabled_features %}
      <h1>{% trans "organizational hierarchy for"|capfirst %} {{ organization }}</h1>
      <form name="orgunit_filters"
            id="filter_form"
            class="orgunit_filtering_wrapper"
            onsubmit="return false"
            hx-get="{% url "orgunit-list" organization.slug %}"
            hx-trigger="change, keyup delay:200ms from:#search_field"
            hx-swap="outerHTML"
            hx-select=".root"
            hx-target=".root"
            hx-include="[id='dropdown_options'], [id='filter_form']">
        <div class="orgunit_input_wrapper search_field_wrapper">
          <input type="search"
                 name="search_field"
                 id="search_field"
                 placeholder="{% trans "Search for organizational unit" %}"
                 value="{{ request.GET.search_field }}"/>
        </div>
        <div class="orgunit_input_wrapper">
          <input type="checkbox"
                 name="show_empty"
                 id="show_empty"
                 value="on"
                 {% if request.GET.show_empty == "on" %}checked{% endif %}/>
          <label for="show_empty">{% trans "Show empty units" %}</label>
        </div>
      </form>
    </div>
    {% if orgunit_list.exists %}
      <div class="datatable-wrapper card root">
        <table class="orgunit datatable">
          <colgroup>
            <col class="datatable__column--name"/>
            <col class="datatable__column--accounts"/>
            <col class="datatable__column--managers"/>
          </colgroup>
          <thead>
            <tr class="table-topbar">
              <th class="datatable__column--name">{% trans "Organizational unit" %}</th>
              <th class="datatable__column--accounts">{% trans "Associations" %}</th>
              <th class="datatable__column--managers">{% trans "Managers" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for node in orgunit_list|unique_roots %}
              {% include "organizations/orgunit_element.html" with node=node.get_root %}
            {% endfor %}
          </tbody>
          {% include "components/pagination.html" %}
        </table>
      {% else %}
        <div class="datatable-wrapper card root">
          <table class="datatable">
            <colgroup>
              <col class="datatable__column--name"/>
              <col class="datatable__column--accounts"/>
              <col class="datatable__column--managers"/>
            </colgroup>
            <thead>
              <tr class="table-topbar">
                <th class="datatable__column--name">{% trans "Organizational unit" %}</th>
                <th class="datatable__column--accounts">{% trans "Associations" %}</th>
                <th class="datatable__column--managers">{% trans "Managers" %}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="7">
                  <div class="no_units root">{% trans "No organizational units." %}</div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      {% endif %}

    </div>
  {% else %}
    <div class="root">{% trans "Organizational structure is not available." %}</div>
  {% endif %}
{% endblock %}
