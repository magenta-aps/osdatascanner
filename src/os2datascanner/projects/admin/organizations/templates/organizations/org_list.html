{% extends 'organizations/base.html' %}
{% load staticfiles %}
{% load i18n %}

{% block title %}{% trans "organizations"|capfirst %}{% endblock %}

{% block content %}

{%  for client in client_list %}
    <div class="aside">
        <h1 class="page-title">
            {% trans 'organizations for'|capfirst %} {{ client }}
        </h1>
        <div class="btn">
            <a 
            class="button button--cta" 
            href="{% url 'add-organization-for' client_id=client.pk %}"
            title="{% trans 'Add new organization' %}">
              <svg class="icon icon--white">
                <use xlink:href="/static/src/svg/symbol-defs.svg#icon-plus"></use>
              </svg>
              <span>
                {% trans "Add new organization" %}
              </span>
            </a>
        </div>
    </div>

    <table class="datatable">
        <thead>
            <tr>
                <th class="datatable__column--name">{% trans "name"|capfirst %}</th>
                <th class="datatable__column--info">{% trans "email"|capfirst %}</th>
                <th class="datatable__column--info">{% trans "phone"|capfirst %}</th>
                <!-- TODO: add conditional columns for users and units dependent on FEATURES.ORG_STRUCTURE (see below) -->
                {% if FEATURES.IMPORT_SERVICES in client.enabled_features %}
                    <th class="datatable__column--btn">{% trans "import service"|capfirst %}</th>
                {% endif %}
            </tr>
        </thead>
        {% if client.organizations.all %}
        <tbody>
            {% for organization in client.organizations.all %}
            <tr>
                <td class="datatable__column--name"><a href="{% url 'edit-organization' slug=organization.slug %}">{{ organization.name }}</a></td>
                <td class="datatable__column--info">
                    {{ organization.contact_email|default_if_none:"-" }}
                </td>
                <td class="datatable__column--info">
                    {{ organization.contact_phone|default_if_none:"-" }}
                </td>
                <!-- TODO: add conditional columns for users and units dependent on FEATURES.ORG_STRUCTURE (see below) -->
                {% if FEATURES.IMPORT_SERVICES in client.enabled_features %}
                <td class="datatable__column--btn">
                    <div class="flex flex--icon">
                        <!-- NB: importservice is in one word because a reverse name was not specified on the ImportService model's relation to Organization and this is the default -->
                        {% if not organization.importservice %}
                        <a
                            href="{% url 'add-ldap' org_id=organization.pk %}"
                            id="button-add-configuration" 
                            type="button" 
                            class="button button--transparent">
                            <i id="library_add" title="Tilføj LDAP konfiguration" class="material-icons">library_add</i>
                        </a>
                        {% else %}
                        <a
                            href="{% url 'edit-ldap' pk=organization.pk %}"
                            id="button-add-configuration" 
                            type="button" 
                            class="button button--transparent">
                            <i id="library_add_check" title="Redigér LDAP konfiguration" class="material-icons">library_add_check</i>
                        </a>
                        <a
                        href="{% url 'import-ldap' pk=organization.pk %}"
                        id="button-add-configuration" 
                        type="button" 
                        title="{% trans 'sync'|capfirst %}"
                        class="button button--transparent button--transparent--text btn-text">
                        {% trans "sync"|capfirst %}
                        </a>
                            <!-- TODO: re-introduce when last_sync field has been added
                        <span class="text">
                            {% trans "last synced"|capfirst %}:<br>
                            {{ organization.importservice.last_sync }}
                        </span>
                        -->
                        {% endif %}
                    </div>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
        {% endif %}
    </table>
    {% if not client.organizations.all %}
        <p>
            {% trans "no organization added"|capfirst %}
        </p>
    {% endif %}
{% endfor %}
{% endblock %}