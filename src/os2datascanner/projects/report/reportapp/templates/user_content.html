{%  load i18n %}
{% load get_settings_tag %}
{% settings_value "SAML2_ENABLED" as saml2_enabled %}

<h1 class="userprofile-text"> {% trans "Account" %} </h1>

<form name="delegate-matches-form" id="delegate-matches-form"
      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>

<div class="userprofile-content-wrapper user-image">
    <span class="user__avatar_verybig">
      {% if request.user.account.image %}
        <img class="userprofile-image" src="{{ request.user.account.image }}">
      {% else %}
        <i id="account_circle" class="material-icons">account_circle</i>
      {% endif %}
    </span>
</div>

<div class="userprofile-content-wrapper user-tables">
  <h2>{% trans "Account information" %}</h2>
  <table class="userprofile-table account-info">
    <tbody>
      <tr>
        <td>{% trans "Name" %}</td>
        <td>{{ user.get_full_name }}</td>
      </tr>
      <tr>
        <td>{% trans "Username" %}</td>
        <td>{{ user.username }}</td>
      </tr>
      <tr>
        <td>{% trans "E-mail" %}</td>
        <td>{{ user.email }}</td>
      </tr>
      <tr>
        <td>{% trans "Organization" %}</td>
        <td>
          {% if user.account.organization %}
            {{ user.account.organization }}
          {% endif %}
        </td>
      </tr>
      {% if settings.DELEGATE_ALL_MATCHES and other_users %}
      <tr>
        <td>{% trans "Delegate matches to" %}</td>
        <td class="dropdown">
          <select name="delegate_to" id="delegate_to" autocomplete="off"
                  hx-post="{% url "delegate_all" %}" hx-trigger="click changed" hx-swap="afterend" hx-target="this"
                  hx-include='[name="delegate-matches-form"]' hx-indicator="#message-sent-popup"
          >
            <option value="none">{% trans "None" %}</option>
          {% for other_user in other_users %}
            {% if other_user != user.account%}
            <option value='{{ other_user.uuid }}' {% if other_user.uuid == user.account.delegate_all_to.account.uuid %} selected="selected" {% endif %}>
              {% if other_user.user.get_full_name %}
              {{ other_user.user.get_full_name }}
              {% elif other_user.first_name or other_user.last_name %}
              {{ other_user.first_name }} {{ other_user.last_name }}
              {% else %}
              {{ other_user.username }}
              {% endif %}
            </option>
            {% endif %}
          {% endfor %}
          </select>
        </td>
      </tr>
      <tr>
        <td>{% trans "Delegation message" %}</td>
        <td class="textbox">
          <textarea name="delegation_message" id="delegation_message" maxlength="500" placeholder="{% trans "Write a message for the person you are delegating your matches to." %}"
                    hx-post="{% url "delegate_all" %}" hx-trigger="keyup changed delay:1s" hx-swap="afterend" hx-target="this"
                    hx-include='[name="delegate-matches-form"]' hx-indicator="#message-saved-popup"
          >{% if user.account.delegate_all_message != None %}{{ user.account.delegate_all_message }}{% endif %}</textarea>
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <div class="message-popup" id="message-saved-popup">
    {% trans "Message saved!" %}
  </div>

  <div class="message-popup" id="message-sent-popup">
    {% trans "Message sent!" %}
  </div>

  <h2>{% trans "User Rights" %}</h2>
  <table class="userprofile-table user-rights">
    <tbody>
      {% if user_roles %}
      <tr>
        <td>{% trans "Roles" %}</td>
        <td>
          <ul>
            {% for role in user_roles %}
              <li>{{ role|capfirst }}</li>
            {% endfor %}
          </ul>
        </td>
      </tr>
      {% endif %}
      {% if user.is_active %}
      <tr>
        <td>{% trans "Active" %}</td>
        <td>
          <span class="checkmark true">
            {% include "components/svg-icons/check_circle_full.svg" %}
            <span class="width">{% trans "Yes" %}</span>
          </span>
        </td>
      </tr>
      {% endif %}
      {% if user.is_staff %}
      <tr>
        <td>{% trans "Staff" %}</td>
        <td>
          <span class="checkmark true">
            {% include "components/svg-icons/check_circle_full.svg" %}
            <span class="width">{% trans "Yes" %}</span>
          </span>
        </td>
      </tr>
      {% endif %}
      {% if user.is_superuser %}
      <tr>
        <td>{% trans "Superuser" %}</td>
        <td>
          <span class="checkmark true">
            {% include "components/svg-icons/check_circle_full.svg" %}
            <span class="width">{% trans "Yes" %}</span>
          </span>
        </td>
      </tr>
      {% endif %}
      {% if aliases %}
      <tr>
        <td>{% trans "Aliases" %}</td>
        <td>
          <ul>
            {% for alias in aliases %}
              <li>{{ alias.value }} ({{ alias.alias_type }})</li>
            {% endfor %}
          </ul>
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <h2>{% trans "Login Information" %}</h2>
  <table class="userprofile-table login-info">
    <tbody>
      {% if not saml2_enabled %}
        <tr>
          <td>{% trans "Password" %}</td>
          <td>
            <a class="password-change" href="/accounts/password_change">
              {% trans "Change" %}
            </a>
          </td>
        </tr>
      {% endif %}
      <tr>
        <td>{% trans "User since" %}</td>
        <td>{{ user.date_joined }}</td>
      </tr>
    </tbody>
  </table>
</div>
</form>
